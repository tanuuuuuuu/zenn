---
title: "[A] Raw Vault"
free: false
---

Raw Vault ã®ç›®çš„ã¯ã€ç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹é–“ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’çµ±åˆã™ã‚‹ã“ã¨ã§ã™ã€‚


# ğŸ”¶ Hubï¼ˆãƒãƒ–ï¼‰
Hub ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¯ã€ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ã‚¢ã‚’ãƒ¢ãƒ‡ãƒ«åŒ–ã—ãŸã‚‚ã®ã§ã€å…·ä½“çš„ã«ã¯ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è­˜åˆ¥ã™ã‚‹ 1 ã¤ã¾ãŸã¯è¤‡æ•°ã®ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼ã‚’æ ¼ç´ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/2f5301e3ac10-20221108.png)


## ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ 

Hub ã‚’æ§‹æˆã™ã‚‹å±æ€§ã¯ã€ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

| Column | Type | Description |
|--------|------|-------------|
| **Multi-tenant id** | `string` | ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆ IDã€‚1 ã¤ã®ãƒ†ãƒŠãƒ³ãƒˆã®å ´åˆã€`default` ã‚’æŒ‡å®šã€‚ |
| **Business key collision code** | `string` | ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼è¡çªé˜²æ­¢ã‚³ãƒ¼ãƒ‰ã€‚ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼ã‚’ç”Ÿæˆã™ã‚‹ã‚½ãƒ¼ã‚¹ãŒ 1 ã¤ã—ã‹ãªã„å ´åˆã€`default` ã‚’æŒ‡å®šã€‚ã€€|
| **Hash key(PK)** | `binary` | ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è­˜åˆ¥ã™ã‚‹ãƒãƒƒã‚·ãƒ¥ãƒ™ãƒ¼ã‚¹ã®ä»£ç†ã‚­ãƒ¼ã€‚ã€€|
| **Load date** | `datetime` | ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼ãŒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã«åˆ°ç€ã—ãŸã¨ãã®æœ€åˆã®æ—¥æ™‚ã€‚ |
| **Record source** | `string` | ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼ã‚’ä¾›çµ¦ã—ãŸæœ€åˆã®è¨˜éŒ²ã‚½ãƒ¼ã‚¹ã€‚ |
| **Business Key(s)** | `string` | 1 ã¤ã¾ãŸã¯ã€è¤‡æ•°ã®ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼ï¼ˆè¤‡åˆã‚­ãƒ¼ã€ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼ï¼‰ã€‚ |
| \<Applied timestamp\> | `datetime` | ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã€‚ |
| \<Task id\> | `string` | ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¾›çµ¦ã—ãŸæœ€åˆã®ã‚¿ã‚¹ã‚¯ IDã€‚ |
| \<User id\> | `string` | ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¾›çµ¦ã—ãŸæœ€åˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ IDã€‚ |
| \<JIRA id\> | `string` | ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¾›çµ¦ã—ãŸæœ€åˆã® JIRA ã‚¿ã‚¹ã‚¯ IDã€‚ |
| \[Last seen date\] | `datetime` | ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼ãŒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã«åˆ°ç€ã—ãŸã¨ãã®æœ€å¾Œã®æ—¥æ™‚ã€‚ |

- `<>`: ã‚ªãƒ—ã‚·ãƒ§ãƒ³
- `[]`: éæ¨å¥¨


## å‘½ååŸºæº–
- Hub: `h_`, **`hub_`**


## ãƒ¢ãƒ‡ãƒªãƒ³ã‚°

ã“ã®è¨˜äº‹ã§ã¯ã€Hubã€Linkã€Satellite ç« ã®å„ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ç¯€ã«ã¦ã€Raw Vault ã®åŸºæœ¬å½¢ã®ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã®æ‰‹é †ã«ã¤ã„ã¦ã€å…±é€šã®ã‚µãƒ³ãƒ—ãƒ« CSV ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨ã„ã¦ã„ã¾ã™ã€‚

ãƒ‡ãƒ¼ã‚¿ã®æ¦‚è¦ã¯ã€Œæ¶ç©ºã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚·ãƒ§ãƒƒãƒ—ã®è³¼è²·å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã€ã¨æƒ³åƒã—ã¦èª­ã¿é€²ã‚ã¦ãã ã•ã„ã€‚



### 1. åˆå›ãƒ­ãƒ¼ãƒ‰

```plain:OrderReport.csv
| order_id | order_item_no | order_date          | order_status | shipping_cost | order_price | product_id | product_name | product_price | item_quantity | item_price | user_id | user_name |
|----------|---------------|---------------------|--------------|---------------|-------------|------------|--------------|---------------|---------------|------------|---------|-----------|
| 1        | 1             | 2022-12-31 9:00:00  | shipped      | 300           | 1800        | a          | Apple        | 1000          | 1             | 1000       | A       | hoge      |
| 1        | 2             | 2022-12-31 9:00:00  | shipped      | 300           | 1800        | b          | Banana       | 500           | 1             | 500        | A       | hoge      |
| 2        | 1             | 2022-12-31 19:00:00 | pending      | 300           | 2300        | a          | Apple        | 1000          | 2             | 2000       | B       | fuga      |
```

ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹é€ ã‚’æŠŠæ¡ã™ã‚‹ãŸã‚ã«æ­£è¦åŒ–ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/e4021276b0b2-20221110.png)

ã“ã® CSV ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹é€ ã‹ã‚‰ã€3 ç¨®é¡ã®ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼ãŒè¦‹ã¤ã‹ã£ãŸã®ã§ã€3 ã¤ã® Hub ã‚’ç‰¹å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

1. `order_id`
2. `product_id`
3. `user_id`

:::message alert
å¾“å±å­ã‚­ãƒ¼ `order_item_no` ã¯ã€ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
:::

â†“ Data Vault ãƒ¢ãƒ‡ãƒªãƒ³ã‚°

![](https://storage.googleapis.com/zenn-user-upload/e3309742ea8b-20221108.png)

```plain:ğŸ”¶ hub_order
| dv_tenantid | dv_bkcc | dv_hashkey_order            | dv_loadts                  | dv_recsrc       | order_id |
|-------------|---------|-----------------------------|----------------------------|-----------------|----------|
| default     | default | hash("default||default||1") | 2023-01-01T00:00:00.000000 | OrderReport.csv | 1        |
| default     | default | hash("default||default||2") | 2023-01-01T00:00:00.000000 | OrderReport.csv | 2        |
```

```plain:ğŸ”¶ hub_product
| dv_tenantid | dv_bkcc | dv_hashkey_product          | dv_loadts                  | dv_recsrc       | product_id |
|-------------|---------|-----------------------------|----------------------------|-----------------|------------|
| default     | default | hash("default||default||a") | 2023-01-01T00:00:00.000000 | OrderReport.csv | a          |
| default     | default | hash("default||default||b") | 2023-01-01T00:00:00.000000 | OrderReport.csv | b          |
```

```plain:ğŸ”¶ hub_user
| dv_tenantid | dv_bkcc | dv_hashkey_user             | dv_loadts                  | dv_recsrc       | user_id    |
|-------------|---------|-----------------------------|----------------------------|-----------------|------------|
| default     | default | hash("default||default||A") | 2023-01-01T00:00:00.000000 | OrderReport.csv | A          |
| default     | default | hash("default||default||B") | 2023-01-01T00:00:00.000000 | OrderReport.csv | B          |
```

### 2. 2 å›ç›®ä»¥é™ã®ãƒ­ãƒ¼ãƒ‰

Hub ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ã€æ–°ã—ã„ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æµã‚Œã‚’è¦‹ã¦ã¿ã¾ã™ã€‚

```plain:OrderReport.csvï¼ˆæ›´æ–°ãƒ‡ãƒ¼ã‚¿ï¼‰
| order_id | order_item_no | order_date          | order_status | shipping_cost | order_price | product_id | product_name | product_price | item_quantity | item_price | user_id | user_name |
|----------|---------------|---------------------|--------------|---------------|-------------|------------|--------------|---------------|---------------|------------|---------|-----------|
| 2        | 1             | 2022-12-31 19:00:00 | shipped      | 300           | 2300        | a          | Apple        | 1000          | 2             | 2000       | B       | fuga      |
| 3        | 1             | 2023-01-01 3:00:00  | shipped      | 300           | 800         | b          | Banana       | 500           | 1             | 500        | C       | piyo      |
```
ã“ã®æ›´æ–°ãƒ‡ãƒ¼ã‚¿ã«ã¯ã€æ–°ã—ã„æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã¨éå»ã®æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

- æ³¨æ–‡ ID ãŒ `3` ã§ã‚ã‚‹æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ 
- æ³¨æ–‡ ID ãŒ `2` ã§ã‚ã‚‹æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã®æ³¨æ–‡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ `pending` ã‹ã‚‰ `shipped` ã«å¤‰æ›´

â†“ Data Vault ãƒ¢ãƒ‡ãƒªãƒ³ã‚°

```plain:ğŸ”¶ hub_orderï¼ˆè¿½åŠ ï¼‰
| dv_tenantid | dv_bkcc | dv_hashkey_order            | dv_loadts                  | dv_recsrc       | order_id |
|-------------|---------|-----------------------------|----------------------------|-----------------|----------|
| default     | default | hash("default||default||1") | 2023-01-01T00:00:00.000000 | OrderReport.csv | 1        |
| default     | default | hash("default||default||2") | 2023-01-01T00:00:00.000000 | OrderReport.csv | 2        |
| default     | default | hash("default||default||3") | 2023-01-02T00:00:00.000000 | OrderReport.csv | 3        |
```

```plain:ğŸ”¶ hub_productï¼ˆè¿½åŠ ãªã—ï¼‰
| dv_tenantid | dv_bkcc | dv_hashkey_product          | dv_loadts                  | dv_recsrc       | product_id |
|-------------|---------|-----------------------------|----------------------------|-----------------|------------|
| default     | default | hash("default||default||a") | 2023-01-01T00:00:00.000000 | OrderReport.csv | a          |
| default     | default | hash("default||default||b") | 2023-01-01T00:00:00.000000 | OrderReport.csv | b          |
```

```plain:ğŸ”¶ hub_userï¼ˆè¿½åŠ ï¼‰
| dv_tenantid | dv_bkcc | dv_hashkey_user             | dv_loadts                  | dv_recsrc       | user_id    |
|-------------|---------|-----------------------------|----------------------------|-----------------|------------|
| default     | default | hash("default||default||A") | 2023-01-01T00:00:00.000000 | OrderReport.csv | A          |
| default     | default | hash("default||default||B") | 2023-01-01T00:00:00.000000 | OrderReport.csv | B          |
| default     | default | hash("default||default||C") | 2023-01-02T00:00:00.000000 | OrderReport.csv | C          |
```



# ğŸ”— Linkï¼ˆãƒªãƒ³ã‚¯ï¼‰
Link ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¯ã€2 ã¤ä»¥ä¸Šã®ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆHubï¼‰é–“ã®é–¢ä¿‚ã‚„é–¢é€£æ€§ã‚’ãƒ¢ãƒ‡ãƒ«åŒ–ã—ãŸã‚‚ã®ã§ã™ã€‚ï¼ˆåŒã˜ Hub ã‚’ 2 å›ä»¥ä¸Šä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ï¼‰

![](https://storage.googleapis.com/zenn-user-upload/9967535580d4-20221108.png)

## ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ 
Link ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’æ§‹æˆã™ã‚‹å±æ€§ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

| Column | Type | Description |
|--------|------|-------------|
| **Multi-tenant id** | `string` | ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆ IDã€‚1 ã¤ã®ãƒ†ãƒŠãƒ³ãƒˆã®å ´åˆã€`default` ã‚’æŒ‡å®šã€‚ |
| **Link Hash key(PK)** | `binary` | ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é–¢é€£æ€§ã‚’è­˜åˆ¥ã™ã‚‹ãƒãƒƒã‚·ãƒ¥ãƒ™ãƒ¼ã‚¹ã®ä»£ç†ã‚­ãƒ¼ã€‚ã€€|
| **Load date** | `datetime` | ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é–¢é€£æ€§ãŒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã«åˆ°ç€ã—ãŸã¨ãã®æœ€åˆã®æ—¥æ™‚ã€‚ |
| **Record source** | `string` | ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é–¢é€£æ€§ã‚’ä¾›çµ¦ã—ãŸæœ€åˆã®è¨˜éŒ²ã‚½ãƒ¼ã‚¹ã€‚ |
| **Hub Hash Keys(FK)** | `string` | ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é–¢é€£æ€§ã‚’è¡¨ã™ 2 ã¤ä»¥ä¸Šã®ä»£ç†ã‚­ãƒ¼ã€‚ |
| \<Applied timestamp\> | `datetime` | ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã€‚ |
| \<Task id\> | `string` | ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é–¢é€£æ€§ã‚’ä¾›çµ¦ã—ãŸæœ€åˆã®ã‚¿ã‚¹ã‚¯ IDã€‚ |
| \<User id\> | `string` | ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é–¢é€£æ€§ã‚’ä¾›çµ¦ã—ãŸæœ€åˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ IDã€‚ |
| \<JIRA id\> | `string` | ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é–¢é€£æ€§ã‚’ä¾›çµ¦ã—ãŸæœ€åˆã® JIRA ã‚¿ã‚¹ã‚¯ IDã€‚ |
| \[Last seen date\] | `datetime` | ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é–¢é€£æ€§ãŒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã«åˆ°ç€ã—ãŸã¨ãã®æœ€å¾Œã®æ—¥æ™‚ã€‚ |
| \<Dependent-child key(s)\> | `any` | å¾“å±å­ã‚­ãƒ¼ã€‚ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã‚’ã‚ˆã‚Šæ˜ç¢ºã«ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ 1 ã¤ã¾ãŸã¯è¤‡æ•°ã®ã‚­ãƒ¼ã€‚ |

- `<>`: ã‚ªãƒ—ã‚·ãƒ§ãƒ³
- `[]`: éæ¨å¥¨

:::message
ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼è¡çªé˜²æ­¢ã‚³ãƒ¼ãƒ‰ï¼ˆ`Business key collision code`ï¼‰ã¯ã€ãƒãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã«å«ã¾ã‚Œã¦ã„ã‚‹ã®ã§ä¸è¦ã§ã™ã€‚
:::


## å‘½ååŸºæº–
- Link: `l_`, **`lnk_`**
- Same-As Link: `l_`, `lnk_`, `sal_`, **`lnks_`**
- Hierarchy Link: `l_`, `lnk_`, `hal_`, **`lnkh_`**


## ãƒ¢ãƒ‡ãƒªãƒ³ã‚°

Hub ç« ã®ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ç¯€ã¨åŒæ§˜ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨ã„ã¦ã€Link ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚

### 1. åˆå›ãƒ­ãƒ¼ãƒ‰
```plain:OrderReport.csv
| order_id | order_item_no | order_date          | order_status | shipping_cost | order_price | product_id | product_name | product_price | item_quantity | item_price | user_id | user_name |
|----------|---------------|---------------------|--------------|---------------|-------------|------------|--------------|---------------|---------------|------------|---------|-----------|
| 1        | 1             | 2022-12-31 9:00:00  | shipped      | 300           | 1800        | a          | Apple        | 1000          | 1             | 1000       | A       | hoge      |
| 1        | 2             | 2022-12-31 9:00:00  | shipped      | 300           | 1800        | b          | Banana       | 500           | 1             | 500        | A       | hoge      |
| 2        | 1             | 2022-12-31 19:00:00 | pending      | 300           | 2300        | a          | Apple        | 1000          | 2             | 2000       | B       | fuga      |
```

![](https://storage.googleapis.com/zenn-user-upload/e4021276b0b2-20221110.png)


ã“ã® CSV ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹é€ ã‹ã‚‰ã€ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼ã®é–“ã«ã€2 ã¤ã®é–¢é€£æ€§ã®ä½œæ¥­å˜ä½ï¼ˆUnit-of-workï¼‰ã‚’ç‰¹å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

1. `order_id`, `product_id`
2. `order_id`, `user_id`

â†“ Data Vault ãƒ¢ãƒ‡ãƒªãƒ³ã‚°

![](https://storage.googleapis.com/zenn-user-upload/e66c8804d258-20221108.png)

Hub ãƒ†ãƒ¼ãƒ–ãƒ«ã¯å‰²æ„›ã€‚

```plain:ğŸ”— lnk_order_product
| dv_tenantid | dv_hashkey_order_product                          | dv_loadts                  | dv_recsrc       | dv_hashkey_order            | dv_hashkey_product           |
|-------------|---------------------------------------------------|----------------------------|-----------------|-----------------------------|------------------------------|
| default     | hash("default||default||1||default||default||a")  | 2023-01-01T00:00:00.000000 | OrderReport.csv | hash("default||default||1") | hash("default||default||a")  |
| default     | hash("default||default||1||default||default||b")  | 2023-01-01T00:00:00.000000 | OrderReport.csv | hash("default||default||1") | hash("default||default||b")  |
| default     | hash("default||default||2||default||default||a")  | 2023-01-01T00:00:00.000000 | OrderReport.csv | hash("default||default||2") | hash("default||default||a")  |
```

```plain:ğŸ”— lnk_order_user
| dv_tenantid | dv_hashkey_order_user                             | dv_loadts                  | dv_recsrc       | dv_hashkey_order            | dv_hashkey_user              |
|-------------|---------------------------------------------------|----------------------------|-----------------|-----------------------------|------------------------------|
| default     | hash("default||default||1||default||default||A")  | 2023-01-01T00:00:00.000000 | OrderReport.csv | hash("default||default||1") | hash("default||default||A")  |
| default     | hash("default||default||2||default||default||B")  | 2023-01-01T00:00:00.000000 | OrderReport.csv | hash("default||default||2") | hash("default||default||B")  |
```

### 2. 2 å›ç›®ä»¥é™ã®ãƒ­ãƒ¼ãƒ‰

Link ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ã€æ–°ã—ã„ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æµã‚Œã‚’è¦‹ã¦ã¿ã¾ã™ã€‚

```plain:OrderReport.csvï¼ˆæ›´æ–°ãƒ‡ãƒ¼ã‚¿ï¼‰
| order_id | order_item_no | order_date          | order_status | shipping_cost | order_price | product_id | product_name | product_price | item_quantity | item_price | user_id | user_name |
|----------|---------------|---------------------|--------------|---------------|-------------|------------|--------------|---------------|---------------|------------|---------|-----------|
| 2        | 1             | 2022-12-31 19:00:00 | shipped      | 300           | 2300        | a          | Apple        | 1000          | 2             | 2000       | B       | fuga      |
| 3        | 1             | 2023-01-01 3:00:00  | shipped      | 300           | 800         | b          | Banana       | 500           | 1             | 500        | C       | piyo      |
```
ã“ã®æ›´æ–°ãƒ‡ãƒ¼ã‚¿ã«ã¯ã€æ–°ã—ã„æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã¨éå»ã®æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

- æ³¨æ–‡ ID ãŒ `3` ã§ã‚ã‚‹æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ 
- æ³¨æ–‡ ID ãŒ `2` ã§ã‚ã‚‹æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã®æ³¨æ–‡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ `pending` ã‹ã‚‰ `shipped` ã«å¤‰æ›´

â†“ Data Vault ãƒ¢ãƒ‡ãƒªãƒ³ã‚°

Hub ãƒ†ãƒ¼ãƒ–ãƒ«ã¯å‰²æ„›ã€‚

```plain:ğŸ”— lnk_order_productï¼ˆè¿½åŠ ï¼‰
| dv_tenantid | dv_hashkey_order_product                          | dv_loadts                  | dv_recsrc       | dv_hashkey_order            | dv_hashkey_product           |
|-------------|---------------------------------------------------|----------------------------|-----------------|-----------------------------|------------------------------|
| default     | hash("default||default||1||default||default||a")  | 2023-01-01T00:00:00.000000 | OrderReport.csv | hash("default||default||1") | hash("default||default||a")  |
| default     | hash("default||default||1||default||default||b")  | 2023-01-01T00:00:00.000000 | OrderReport.csv | hash("default||default||1") | hash("default||default||b")  |
| default     | hash("default||default||2||default||default||a")  | 2023-01-01T00:00:00.000000 | OrderReport.csv | hash("default||default||2") | hash("default||default||a")  |
| default     | hash("default||default||3||default||default||a")  | 2023-01-02T00:00:00.000000 | OrderReport.csv | hash("default||default||3") | hash("default||default||a")  |
```

```plain:ğŸ”— lnk_order_userï¼ˆè¿½åŠ ï¼‰
| dv_tenantid | dv_hashkey_order_user                             | dv_loadts                  | dv_recsrc       | dv_hashkey_order            | dv_hashkey_user              |
|-------------|---------------------------------------------------|----------------------------|-----------------|-----------------------------|------------------------------|
| default     | hash("default||default||1||default||default||A")  | 2023-01-01T00:00:00.000000 | OrderReport.csv | hash("default||default||1") | hash("default||default||A")  |
| default     | hash("default||default||2||default||default||B")  | 2023-01-01T00:00:00.000000 | OrderReport.csv | hash("default||default||2") | hash("default||default||B")  |
| default     | hash("default||default||3||default||default||C")  | 2023-01-02T00:00:00.000000 | OrderReport.csv | hash("default||default||3") | hash("default||default||C")  |
```

## ğŸ”— Same-As Linkï¼ˆåŒä¸€ãƒªãƒ³ã‚¯ï¼‰
Same-As Link ã¯ã€Link ãƒ†ãƒ¼ãƒ–ãƒ«ã®åŸºæœ¬å½¢ã®åˆ¥ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€åŒã˜ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç¤ºã™è¤‡æ•°ã®ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼ãŒå­˜åœ¨ã™ã‚‹ã¨ãã®é–¢ä¿‚æ€§ã‚’ãƒ¢ãƒ‡ãƒ«åŒ–ã—ãŸã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚

**ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼ã®çµ±åˆ**ãŒ Same-As Link ã®ç›®çš„ã§ã™ã€‚

:::message
ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã¯ã€Link ã®åŸºæœ¬å½¢ã¨åŒã˜ã§ã™ã€‚
:::

### 1. ç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹é–“ã®ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼ã‚’çµ±åˆã™ã‚‹

ä¸‹ã® 2 ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ã€åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¤‡æ•°ã®æ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ ã§å­˜åœ¨ã—ã€ç•°ãªã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ ID ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ã¨è€ƒãˆã¦ãã ã•ã„ã€‚

```plain:ã‚·ã‚¹ãƒ†ãƒ  A
| user_id | name | age |
|---------|------|-----|
| 1       | hoge | 25  |
| 2       | fuga | 30  |
| 3       | piyo | 35  |
```

```plain:ã‚·ã‚¹ãƒ†ãƒ  B
| user_id | name | dept      |
|---------|------|-----------|
| 9604    | hoge | engineer  |
| 8759    | fuga | marketing |
| 1432    | piyo | engineer  |
```

ç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹é–“ã§ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼ã‚’çµ±åˆã™ã‚‹ã«ã¯ã€MDMï¼ˆãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼‰ã§ã€æ¬¡ã®ã‚ˆã†ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ ID ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```plain:MDM
| system_a | system_b |
|----------|----------|
| 1        | 9604     |
| 2        | 8759     |
| 3        | 1432     |
```

â†“ Data Vault ãƒ¢ãƒ‡ãƒªãƒ³ã‚°

![](https://storage.googleapis.com/zenn-user-upload/359897425bd3-20221109.png)

```plain:ğŸ”¶ hub_user
| dv_tenantid | dv_bkcc | dv_hashkey_user          | dv_loadts                  | dv_recsrc | user_id |
|-------------|---------|--------------------------|----------------------------|-----------|---------|
| default     | a       | hash("default||a||1")    | 2023-01-01T00:00:00.000000 | System A  | 1       |
| default     | a       | hash("default||a||2")    | 2023-01-01T00:00:00.000000 | System A  | 2       |
| default     | a       | hash("default||a||3")    | 2023-01-01T00:00:00.000000 | System A  | 3       |
| default     | b       | hash("default||b||9604") | 2023-01-01T00:00:00.000000 | System B  | 9604    |
| default     | b       | hash("default||b||8759") | 2023-01-01T00:00:00.000000 | System B  | 8759    |
| default     | b       | hash("default||b||1432") | 2023-01-01T00:00:00.000000 | System B  | 1432    |
```

```plain:ğŸ”— lnks_user
| dv_tenantid | dv_hashkey_lnks_user                    | dv_loadts                  | dv_recsrc | dv_hashkey_a_user     | dv_hashkeyb_user         |
|-------------|-----------------------------------------|----------------------------|-----------|-----------------------|--------------------------|
| default     | hash("default||a||1||default||b||9604") | 2023-01-01T00:00:00.000000 | MDM       | hash("default||a||1") | hash("default||b||9604") |
| default     | hash("default||a||2||default||b||8759") | 2023-01-01T00:00:00.000000 | MDM       | hash("default||a||2") | hash("default||b||8759") |
| default     | hash("default||a||3||default||b||1432") | 2023-01-01T00:00:00.000000 | MDM       | hash("default||a||3") | hash("default||b||1432") |
```


### 2. ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒç•°ãªã‚‹ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼ã‚’çµ±åˆã™ã‚‹

ã‚½ãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ ãŒã€åŒã˜ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ç•°ãªã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹å ´åˆã‚‚ Same-As Link ã§ãƒ“ã‚¸ãƒã‚¹ã‚­ãƒ¼ã‚’çµ±åˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

æ¬¡ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ã€è¿”å“ã•ã‚Œã‚‹ã¨å‰ã®ãƒ‡ãƒ¼ã‚¿ã¯ãã®ã¾ã¾æ®‹ã‚Šã€æ–°ã—ãè¿”å“ãƒ‡ãƒ¼ã‚¿ï¼ˆ `[business_key]_001`ï¼‰ãŒè¿½åŠ ã•ã‚Œã‚‹ã¨è€ƒãˆã¦ãã ã•ã„ã€‚

```plain:ã‚·ã‚¹ãƒ†ãƒ  A
| order_id | status   | amount | updated_at                 |
|----------|----------|--------|----------------------------|
| 1        | shipped  | 10000  | 2022-12-31T00:00:00.000000 |
| 1-001    | returned | -10000 | 2023-01-01T00:00:00.000000 |
| 2        | shipped  | 5000   | 2022-12-31T00:00:00.000000 |
```

ã“ã®ã‚±ãƒ¼ã‚¹ã®å ´åˆã€MDM ã§ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”¨æ„ã—ãªãã¦ã‚‚ã€SQL ã§ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”¨æ„ã™ã‚‹ã“ã¨ã§ãã¾ã™ã€‚

```plain: ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«
| original | alias  |
|----------|--------|
| 1        | 1-001  |
```

â†“ Data Vault ãƒ¢ãƒ‡ãƒªãƒ³ã‚°

![](https://storage.googleapis.com/zenn-user-upload/72979d1c0893-20221109.png)

```plain:ğŸ”¶ hub_order
| dv_tenantid | dv_bkcc | dv_hashkey_order                | dv_loadts                  | dv_recsrc | order_id |
|-------------|---------|---------------------------------|----------------------------|-----------|----------|
| default     | default | hash("default||default||1")     | 2023-01-01T00:00:00.000000 | System A  | 1        |
| default     | default | hash("default||default||1-001") | 2023-01-02T00:00:00.000000 | System A  | 1-001    |
| default     | default | hash("default||default||2")     | 2023-01-01T00:00:00.000000 | System A  | 2        |
```

```plain:ğŸ”— lnks_order
| dv_tenantid | dv_hashkey_lnks_order                                | dv_loadts                  | dv_recsrc | dv_hashkey_original         | dv_hashkey_alias                |
|-------------|------------------------------------------------------|----------------------------|-----------|-----------------------------|---------------------------------|
| default     | hash("default||default||1||default||default||1-001") | 2023-01-02T00:00:00.000000 | SYSTEM    | hash("default||default||1") | hash("default||default||1-001") |
```


## ğŸ”— Hierarchy Linkï¼ˆéšå±¤ãƒªãƒ³ã‚¯ï¼‰

Hierarchy Link ã¯ã€Link ãƒ†ãƒ¼ãƒ–ãƒ«ã®åŸºæœ¬å½¢ã®åˆ¥ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€åŒã˜æ„å‘³ç²’åº¦ã®ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé–“ã®è¦ªå­éšå±¤ã‚’ãƒ¢ãƒ‡ãƒ«åŒ–ã—ãŸã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚

:::message
ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã¯ã€Link ã®åŸºæœ¬å½¢ã¨åŒã˜ã§ã™ã€‚
:::

å¾“æ¥­å“¡ã‚„çµ„ç¹”å›³ã€è£½å“ã‚«ãƒ†ã‚´ãƒªãªã©ã®è¦ªå­éšå±¤ã‚’è¡¨ç¾ã™ã‚‹ã“ã¨ã§ãã¾ã™ã€‚

```plain:ã‚·ã‚¹ãƒ†ãƒ  A
| user_id | name   | dept      | manager_id |
|---------|--------|-----------|------------|
| 1       | hoge   | engineer  | null       |
| 2       | fuga   | marketing | 1          |
| 3       | piyo   | engineer  | 4          |
| 4       | hogera | engineer  | 1          |
```

ã“ã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ ID `1` ã¯ã€ `2` ã¨ `4` ã®ç›´å±ã®ä¸Šå¸ã§ã‚ã‚Šã€`4` ã¯ `3` ã®ç›´å±ã®ä¸Šå¸ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

```mermaid
flowchart TB
1.hoge --> 4.hogera --> 3.piyo
1.hoge ---> 2.fuga
```

â†“ Data Vault ãƒ¢ãƒ‡ãƒªãƒ³ã‚°

![](https://storage.googleapis.com/zenn-user-upload/548495d1958e-20221107.png)

```plain:ğŸ”¶ hub_user
| dv_tenantid | dv_bkcc | dv_hashkey_user             | dv_loadts                  | dv_recsrc  | user_id |
|-------------|---------|-----------------------------|----------------------------|------------|---------|
| default     | default | hash("default||default||1") | 2023-01-01T00:00:00.000000 | System A   | 1       |
| default     | default | hash("default||default||2") | 2023-01-01T00:00:00.000000 | System A   | 2       |
| default     | default | hash("default||default||3") | 2023-01-01T00:00:00.000000 | System A   | 3       |
| default     | default | hash("default||default||4") | 2023-01-01T00:00:00.000000 | System A   | 4       |
```

```plain:ğŸ”— lnkh_user
| dv_tenantid | dv_hashkey_lnkh_user                             | dv_loadts                  | dv_recsrc  | dv_hashkey_employee         | dv_hashkey_manager          |
|-------------|--------------------------------------------------|----------------------------|------------|-----------------------------|-----------------------------|
| default     | hash("default||default||1||default||default||")  | 2023-01-01T00:00:00.000000 | System A   | hash("default||default||1") | hash("default||default||")  |
| default     | hash("default||default||2||default||default||1") | 2023-01-01T00:00:00.000000 | System A   | hash("default||default||2") | hash("default||default||1") |
| default     | hash("default||default||3||default||default||4") | 2023-01-01T00:00:00.000000 | System A   | hash("default||default||3") | hash("default||default||4") |
| default     | hash("default||default||4||default||default||1") | 2023-01-01T00:00:00.000000 | System A   | hash("default||default||4") | hash("default||default||1") |
```


# ğŸ›°ï¸ Satelliteï¼ˆã‚µãƒ†ãƒ©ã‚¤ãƒˆï¼‰
Satellite ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¯ã€ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒ¢ãƒ‡ãƒ«åŒ–ã—ãŸã‚‚ã®ã§ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ãã®å¤‰æ›´å±¥æ­´ã‚’å…¨ã¦è¨˜éŒ²ã—ã¾ã™ã€‚ï¼ˆSatellite ã¯ãƒ‡ãƒ«ã‚¿ãƒ‰ãƒªãƒ–ãƒ³ã§ã€ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã«ãŠã‘ã‚‹ **Type 2 SCD** ã«ç›¸å½“ã—ã¾ã™ã€‚ï¼‰

![](https://storage.googleapis.com/zenn-user-upload/fde3be15a2bf-20221109.png)

:::message
Hub ã‹ã‚‰ä¼¸ã³ã¦ã„ã‚‹ Satellite ã‚’ **Hub Satellite**ã€ Link ã‹ã‚‰ä¼¸ã³ã¦ã„ã‚‹ Satellite ã‚’ **Link Satellite** ã¨å‘¼ã¶ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚
:::


### ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ 

Satellite ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’æ§‹æˆã™ã‚‹å±æ€§ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

| Column | Type | Description |
|--------|------|-------------|
| **Multi-tenant id** | `string` | ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆ IDã€‚1 ã¤ã®ãƒ†ãƒŠãƒ³ãƒˆã®å ´åˆã€`default` ã‚’æŒ‡å®šã€‚ |
| **Hash key(PK, FK)** | `binary` | a |
| **Load date(PK)** | `datetime` | a |
| **Load-end date** | `datetime` | a |
| **Record source** | `string` | a |
| **Hash difference** | `binary` | a |
| \<Applied timestamp\> | `datetime` | a |
| \<Task id\> | `string` | a |
| \<User id\> | `string` | a |
| \<Dependent-child key(s)\> | `any` | a |
| **Attributes** | `any` | a |

- `<>`: ã‚ªãƒ—ã‚·ãƒ§ãƒ³
- `[]`: éæ¨å¥¨


## å‘½ååŸºæº–
- Satellite: `s_`, **`sat_`**
- Non-Historized Link / Satellite: **`lnkn_`** / **`satn_`**
- Multi-Active Satellite: `mas_`, **`satm_`**
- Status Tracking Satellite: `sts_`, **`sats_`**
- Record Tracking Satellite: `rts_`, **`satr_`**
- Effective Satellite: `efs_`, **`sate_`**
- Extended Record Tracking Satellite: `xts_`, **`satx_`**


## Load-end dateï¼ˆãƒ­ãƒ¼ãƒ‰çµ‚äº†æ—¥ï¼‰

`Load-end date` ã«ã¯ã€ãã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãŒ DWH ã§æœ‰åŠ¹ã ã£ãŸæœ€å¾Œã®æ—¥æ™‚ã‚’è¨˜éŒ²ã™ã‚‹å½¹å‰²ãŒã‚ã‚Šã¾ã™ã€‚

:::message alert
`Load-end date` ã¯ã€ã‚½ãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ ã®æœ‰åŠ¹æœŸé™ã‚’è¨˜éŒ²ã™ã‚‹ã‚‚ã®ã§ã¯ãªã„ã“ã¨ã«æ³¨æ„ã—ã¾ã—ã‚‡ã†ã€‚
:::

æœ€æ–°ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã®`Load-end date` ã«ã¯ã€`null` ã¾ãŸã¯ã€€`9999-12-31` ãªã©ã®å€¤ãŒæ ¼ç´ã•ã‚Œã€ãã®ç›´å‰ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã® `Load-end date` ã«ã¯ã€æœ€æ–°ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã® `Load date` ã®å€¤ï¼ˆã¾ãŸã¯ -1 ãƒã‚¤ã‚¯ãƒ­ç§’ãªã©ï¼‰ãŒæ ¼ç´ã•ã‚Œã¾ã™ã€‚

```
| dv_hashkey_order            | dv_loadts                  | dv_loadendts               | order_status |
|-----------------------------|----------------------------|----------------------------|--------------|
| hash("default||default||1") | 2023-01-01T00:00:00.000000 | null                       | shipped      |
| hash("default||default||2") | 2023-01-01T00:00:00.000000 | 2023-01-01T23:59:59.999999 | pending      |
| hash("default||default||2") | 2023-01-02T00:00:00.000000 | null                       | shipped      |
```

ä¾‹ãˆã°ã€ã“ã®ã‚ˆã†ã«ãƒ‡ãƒ¼ã‚¿ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã‚Œã°ã€äºŒè¡Œç›®ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã¯ã€`2023-01-01T00:00:00.000000` ã‹ã‚‰ `2023-01-01T23:59:59.999999` ã¾ã§ã€€DWH ã§ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã ã£ãŸã¨ã„ã†ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚


## ãƒ¢ãƒ‡ãƒªãƒ³ã‚°

### 1. åˆå›ãƒ­ãƒ¼ãƒ‰
Hubã€Link ç« ã®ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ç¯€ã¨åŒæ§˜ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨ã„ã¦ã€Satellite ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚

```plain:OrderReport.csv
| order_id | order_item_no | order_date          | order_status | shipping_cost | order_price | product_id | product_name | product_price | item_quantity | item_price | user_id | user_name |
|----------|---------------|---------------------|--------------|---------------|-------------|------------|--------------|---------------|---------------|------------|---------|-----------|
| 1        | 1             | 2022-12-31 9:00:00  | shipped      | 300           | 1800        | a          | Apple        | 1000          | 1             | 1000       | A       | hoge      |
| 1        | 2             | 2022-12-31 9:00:00  | shipped      | 300           | 1800        | b          | Banana       | 500           | 1             | 500        | A       | hoge      |
| 2        | 1             | 2022-12-31 19:00:00 | pending      | 300           | 2300        | a          | Apple        | 1000          | 2             | 2000       | B       | fuga      |
```

![](https://storage.googleapis.com/zenn-user-upload/e4021276b0b2-20221110.png)

ã“ã® CSV ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹é€ ã‹ã‚‰ã€ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç‰¹å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

1. hub_order
	- `order_date`
	- `order_status`
	- `shipping_cost`
	- `order_price`
2. hub_product
	- `product_name`
	- `product_price`
3. hub_user
	- `user_name`
4. lnk_order_product
	- `order_item_no`
	- `item_quantity`
	- `item_price`

â†“ Data Vault ãƒ¢ãƒ‡ãƒªãƒ³ã‚°

![](https://storage.googleapis.com/zenn-user-upload/b29300580ed0-20221110.png)

Hubã€Link ãƒ†ãƒ¼ãƒ–ãƒ«ã¯å‰²æ„›ã€‚

```plain:ğŸ›°ï¸ sat_default_default_order
| dv_tenantid | dv_hashkey_order            | dv_loadts                  | dv_loadendts | dv_recsrc       | dv_hashdiff                                                          | order_date          | order_status | shipping_cost | order_price |
|-------------|-----------------------------|----------------------------|--------------|-----------------|----------------------------------------------------------------------|---------------------|--------------|---------------|-------------|
| default     | hash("default||default||1") | 2023-01-01T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||1||2022-12-31T09:00:00||shipped||300||1800") | 2022-12-31T09:00:00 | shipped      | 300           | 1800        |
| default     | hash("default||default||2") | 2023-01-01T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||2||2022-12-31T19:00:00||pending||300||2300") | 2022-12-31T19:00:00 | pending      | 300           | 2300        |
```

```plain:ğŸ›°ï¸ sat_default_default_product
| dv_tenantid | dv_hashkey_product          | dv_loadts                  | dv_loadendts | dv_recsrc       | dv_hashdiff                              | product_name | product_price |
|-------------|-----------------------------|----------------------------|--------------|-----------------|------------------------------------------|--------------|---------------|
| default     | hash("default||default||a") | 2023-01-01T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||a||Apple||1000") | Apple        | 1000          |
| default     | hash("default||default||b") | 2023-01-01T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||b||Banana||500") | Bnana        | 500           |
```

```plain:ğŸ›°ï¸ sat_default_default_user
| dv_tenantid | dv_hashkey_user             | dv_loadts                  | dv_loadendts | dv_recsrc       | dv_hashdiff                       | user_name |
|-------------|-----------------------------|----------------------------|--------------|-----------------|-----------------------------------|-----------|
| default     | hash("default||default||A") | 2023-01-01T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||A||hoge") | hoge      |
| default     | hash("default||default||B") | 2023-01-01T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||B||fuga") | fuga      |
```

```plain:ğŸ›°ï¸ sat_default_default_orderItem
| dv_tenantid | dv_hashkey_order_product                         | dv_loadts                  | dv_loadendts | dv_recsrc       | dv_hashdiff                                                  | order_item_no | item_quantity | item_price |
|-------------|--------------------------------------------------|----------------------------|--------------|-----------------|--------------------------------------------------------------|---------------|---------------|------------|
| default     | hash("default||default||1||default||default||a") | 2023-01-01T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||1||default||default||a||1||1||1000") | 1             | 1             | 1000       |
| default     | hash("default||default||1||default||default||b") | 2023-01-01T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||1||default||default||b||2||1||500")  | 2             | 1             | 500        |
| default     | hash("default||default||2||default||default||a") | 2023-01-01T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||2||default||default||a||1||2||2000") | 1             | 2             | 2000       |
```

### 2. 2 å›ç›®ä»¥é™ã®ãƒ­ãƒ¼ãƒ‰

Satellite ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ã€æ–°ã—ã„ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å ´åˆã€æ›´æ–°ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ãŸã‚ã¨ã« `Load-end date` åˆ—ã‚’æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```plain:OrderReport.csvï¼ˆæ›´æ–°ãƒ‡ãƒ¼ã‚¿ï¼‰
| order_id | order_item_no | order_date          | order_status | shipping_cost | order_price | product_id | product_name | product_price | item_quantity | item_price | user_id | user_name |
|----------|---------------|---------------------|--------------|---------------|-------------|------------|--------------|---------------|---------------|------------|---------|-----------|
| 2        | 1             | 2022-12-31 19:00:00 | shipped      | 300           | 2300        | a          | Apple        | 1000          | 2             | 2000       | B       | fuga      |
| 3        | 1             | 2023-01-01 3:00:00  | shipped      | 300           | 800         | b          | Banana       | 500           | 1             | 500        | C       | piyo      |
```
ã“ã®æ›´æ–°ãƒ‡ãƒ¼ã‚¿ã«ã¯ã€æ–°ã—ã„æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã¨éå»ã®æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

- æ³¨æ–‡ ID ãŒ `3` ã§ã‚ã‚‹æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ 
- æ³¨æ–‡ ID ãŒ `2` ã§ã‚ã‚‹æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã®æ³¨æ–‡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ `pending` ã‹ã‚‰ `shipped` ã«å¤‰æ›´


â†“ Data Vault ãƒ¢ãƒ‡ãƒªãƒ³ã‚°

Hubã€Link ã¯å‰²æ„›ã€‚

```plain:ğŸ›°ï¸ sat_default_default_orderï¼ˆè¿½åŠ ã€æ›´æ–°ï¼‰
| dv_tenantid | dv_hashkey_order            | dv_loadts                  | dv_loadendts               | dv_recsrc       | dv_hashdiff                                                          | order_date          | order_status | shipping_cost | order_price |
|-------------|-----------------------------|----------------------------|----------------------------|-----------------|----------------------------------------------------------------------|---------------------|--------------|---------------|-------------|
| default     | hash("default||default||1") | 2023-01-01T00:00:00.000000 | null                       | OrderReport.csv | hash("default||default||1||2022-12-31T09:00:00||shipped||300||1800") | 2022-12-31T09:00:00 | shipped      | 300           | 1800        |
| default     | hash("default||default||2") | 2023-01-01T00:00:00.000000 | 2023-01-01T23:59:59.999999 | OrderReport.csv | hash("default||default||2||2022-12-31T19:00:00||pending||300||2300") | 2022-12-31T19:00:00 | pending      | 300           | 2300        |
| default     | hash("default||default||2") | 2023-01-02T00:00:00.000000 | null                       | OrderReport.csv | hash("default||default||2||2022-12-31T19:00:00||shipped||300||2300") | 2022-12-31T19:00:00 | shipped      | 300           | 2300        |
| default     | hash("default||default||3") | 2023-01-02T00:00:00.000000 | null                       | OrderReport.csv | hash("default||default||3||2023-01-01T03:00:00||shipped||300||800")  | 2023-01-01T03:00:00 | shipped      | 300           | 800         |
```

```plain:ğŸ›°ï¸ sat_default_default_productï¼ˆè¿½åŠ ãªã—ï¼‰
| dv_tenantid | dv_hashkey_product          | dv_loadts                  | dv_loadendts | dv_recsrc       | dv_hashdiff                              | product_name | product_price |
|-------------|-----------------------------|----------------------------|--------------|-----------------|------------------------------------------|--------------|---------------|
| default     | hash("default||default||a") | 2023-01-01T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||a||Apple||1000") | Apple        | 1000          |
| default     | hash("default||default||b") | 2023-01-01T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||b||Banana||500") | Bnana        | 500           |
```

```plain:ğŸ›°ï¸ sat_default_default_userï¼ˆè¿½åŠ ï¼‰
| dv_tenantid | dv_hashkey_user             | dv_loadts                  | dv_loadendts | dv_recsrc       | dv_hashdiff                       | user_name |
|-------------|-----------------------------|----------------------------|--------------|-----------------|-----------------------------------|-----------|
| default     | hash("default||default||A") | 2023-01-01T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||A||hoge") | hoge      |
| default     | hash("default||default||B") | 2023-01-01T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||B||fuga") | fuga      |
| default     | hash("default||default||C") | 2023-01-02T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||C||piyo") | piyo      |
```

```plain:ğŸ›°ï¸ sat_default_default_orderItemï¼ˆè¿½åŠ ï¼‰
| dv_tenantid | dv_hashkey_order_product                         | dv_loadts                  | dv_loadendts | dv_recsrc       | dv_hashdiff                                                  | order_item_no | item_quantity | item_price |
|-------------|--------------------------------------------------|----------------------------|--------------|-----------------|--------------------------------------------------------------|---------------|---------------|------------|
| default     | hash("default||default||1||default||default||a") | 2023-01-01T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||1||default||default||a||1||1||1000") | 1             | 1             | 1000       |
| default     | hash("default||default||1||default||default||b") | 2023-01-01T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||1||default||default||b||2||1||500")  | 2             | 1             | 500        |
| default     | hash("default||default||2||default||default||a") | 2023-01-01T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||2||default||default||a||1||2||2000") | 1             | 2             | 2000       |
| default     | hash("default||default||3||default||default||a") | 2023-01-02T00:00:00.000000 | null         | OrderReport.csv | hash("default||default||3||default||default||a||1||1||500")  | 1             | 1             | 500        |
```


## ã‚µãƒ†ãƒ©ã‚¤ãƒˆã®åˆ†å‰²

## ğŸ›°ï¸ Non-Historized Link / Satelliteï¼ˆéå±¥æ­´ãƒªãƒ³ã‚¯ / ã‚µãƒ†ãƒ©ã‚¤ãƒˆï¼‰

## ğŸ›°ï¸ Multi-Active Satelliteï¼ˆãƒãƒ«ãƒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒ†ãƒ©ã‚¤ãƒˆï¼‰
Multi-Active Satellite (MAS) ã¯ã€è¦ªã‚­ãƒ¼ã”ã¨ã«è¤‡æ•°ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’æ ¼ç´ã—ã¾ã™ã€‚

NoSQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ JSON ãƒ•ã‚¡ã‚¤ãƒ«ã€XML ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ˆã†ãªéæ­£è¦åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã™ã‚‹å ´åˆã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è¤‡æ•°ã®å€¤ï¼ˆé…åˆ—ï¼‰ã‚’æŒã¤ã“ã¨ãŒã‚ˆãã‚ã‚Šã¾ã™ã€‚

ä¾‹ãˆã°ã€å¾“æ¥­å“¡ãŒè¤‡æ•°ã®é›»è©±ç•ªå·ã‚’æŒã£ã¦ã„ã‚‹å ´åˆãªã©ã§ã™ã€‚

```json
{
    "user_id": 1,
    "name": "hoge",
    "phone": ["080-1111-1111", "080-1111-1112"],
    "birth": "1990-01-01"
}
```

ã“ã® JSON ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹é€ ã¯ã€éé…åˆ—ã‚«ãƒ©ãƒ ï¼ˆ`name`, `birth`ï¼‰ã¨é…åˆ—ã‚«ãƒ©ãƒ ï¼ˆ`phone`ï¼‰ã§åˆ†å‰²ã•ã‚Œã€ä»¥ä¸‹ã® Satellite ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«å¤‰æ›ã•ã‚Œã¾ã™ã€‚

```mermaid
erDiagram
	rawHub_user ||--|{ rawSat_user : user_hash_key
	rawHub_user ||--|{ rawMSat_userPhone : user_hash_key

rawHub_user {
	user_hash_key string "PK"
	load_date datetime
	record_source string
	user_id int
}

rawSat_user {
	user_hash_key string "PK, FK"
	load_date datetime "PK"
	load_end_date datetime
	record_source string
	hash_diff string
	name string
	birth date
}

rawMSat_userPhone {
	user_hash_key string "PK, FK"
	phone_seq string "PK"
	load_date datetime "PK"
	load_end_date datetime
	record_source string
	hash_diff string
	phone string
}
```

`rawSat_user` ãƒ†ãƒ¼ãƒ–ãƒ«ã¯é€šå¸¸ã® Satellite ã§ã€ `rawMSat_userPhone` ãƒ†ãƒ¼ãƒ–ãƒ«ãŒæœ¬ç¯€ã§å–ã‚Šä¸Šã’ã¦ã„ã‚‹ Multi-Active Satellite ã«ãªã‚Šã¾ã™ã€‚

é€šå¸¸ã®ã€€Satellite ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®æ§‹é€ ã¨ã®é•ã„ã¯ã€ `phone_seq` ã¨ã„ã†ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ã ã‘ã§ã€ã“ã‚Œã¯é›»è©±ç•ªå·ã‚’è­˜åˆ¥ã™ã‚‹ã‚‚ã®ã§ã™ã€‚


## ğŸ›°ï¸ Status Tracking Satelliteï¼ˆçŠ¶æ…‹è¿½è·¡ã‚µãƒ†ãƒ©ã‚¤ãƒˆï¼‰

## ğŸ›°ï¸ Record Tracking Satelliteï¼ˆè¨˜éŒ²è¿½è·¡ã‚µãƒ†ãƒ©ã‚¤ãƒˆï¼‰

## ğŸ›°ï¸ Status Tracking Satelliteï¼ˆçŠ¶æ…‹è¿½è·¡ã‚µãƒ†ãƒ©ã‚¤ãƒˆï¼‰

## ğŸ›°ï¸ Effective Satelliteï¼ˆæœ‰åŠ¹ã‚µãƒ†ãƒ©ã‚¤ãƒˆï¼‰

## ğŸ›°ï¸ Extended Record Tracking Satelliteï¼ˆæ‹¡å¼µè¨˜éŒ²è¿½è·¡ã‚µãƒ†ãƒ©ã‚¤ãƒˆï¼‰