---
title: "dbt Cloud ã® Discovery API ã§ã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®é–¢ä¿‚æ€§ã‚’ mermaid.js ã§å¯è¦–åŒ–ã—ãŸã„ï¼"
emoji: "ğŸ”—"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "dbt"
  - "python"
published: true
published_at: "2024-12-05 00:00"
---

[dbt Advent Calendar 2024](https://qiita.com/advent-calendar/2024/dbt) ã® 5 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

:::message
**ã“ã®è¨˜äº‹ã§å­¦ã¹ã‚‹ã“ã¨**

- ãƒ‡ãƒ¼ã‚¿ã‚«ã‚¿ãƒ­ã‚°ã«ãŠã‘ã‚‹ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†ã®é‡è¦æ€§ã«ã¤ã„ã¦
- dbt Semantic Layer ã§æä¾›ã•ã‚Œã‚‹ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®åŸºæœ¬çš„ãªæ¦‚å¿µ
- dbt Cloud ã® Discovery API ã®å…·ä½“çš„ãªæ´»ç”¨æ–¹æ³•

:::

## èƒŒæ™¯

ç”Ÿæˆ AI ã®æ´»ç”¨ãŒåºƒãŒã‚Šã€RAGï¼ˆRetrieval-Augmented Generationï¼‰ã®ç™»å ´ã«ã‚ˆã‚Šã€ä¼æ¥­ã¯ç‹¬è‡ªã®æ–‡æ›¸ã‚„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®çŸ¥è­˜ã‚’ç”Ÿæˆ AI ã«æ´»ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã—ã‹ã—ã€ãƒ“ã‚¸ãƒã‚¹ã§ã®æœ¬æ ¼æ´»ç”¨ã«å‘ã‘ã¦ã¯ã€ã‚ˆã‚Šæ·±ã„æ–‡è„ˆç†è§£ã¨é«˜ã„å¿œç­”ç²¾åº¦ãŒæ±‚ã‚ã‚‰ã‚Œã€LLM ã‚„ RAG ã®æ€§èƒ½å‘ä¸ŠãŒé‡è¦ãªèª²é¡Œã¨ãªã£ã¦ã„ã¾ã™ã€‚

ãã‚“ãªä¸­ã€ã„ã¾å¯†ã‹ã«ãƒ‡ãƒ¼ã‚¿ç•Œéšˆã§æ³¨ç›®ã‚’é›†ã‚ã¦ã„ã‚‹ã®ãŒã€**ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼**ã€ã¨ã„ã†æŠ€è¡“ã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã«æ„å‘³ã‚„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä»˜ä¸ã™ã‚‹ã“ã®æŠ€è¡“ã¯ã€çµ„ç¹”å›ºæœ‰ã®çŸ¥è­˜ã‚’ç”Ÿæˆ AI ã«åŠ¹ç‡çš„ã«å­¦ç¿’ã•ã›ã‚‹éµã¨ã—ã¦æœŸå¾…ã•ã‚Œã¦ã„ã¾ã™ã€‚

dbt Labs ã¯ã€**dbt Semantic Layer**ã€ã¨ã„ã†ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚åŒç¤¾ã¯å…ˆæ—¥é–‹å‚¬ã•ã‚ŒãŸ dbt coalesce 2024 ã«ãŠã„ã¦ã€**å˜ãªã‚‹ãƒ‡ãƒ¼ã‚¿å¤‰æ›ãƒ„ãƒ¼ãƒ«ã§ã¯ãªãã€ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«å…¨ä½“ã‚’æ‹…ã†ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’ç›®æŒ‡ã™ãƒ“ã‚¸ãƒ§ãƒ³**ã‚’æ²ã’ã¦ãŠã‚Šã€ä»Šå¾Œã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼æ©Ÿèƒ½ãŒã•ã‚‰ã«å¼·åŒ–ã•ã‚Œã‚‹ã“ã¨ãŒæœŸå¾…ã•ã‚Œã¦ã„ã¾ã™ã€‚

![](/images/ee31bc0466094d/dbt_data_control_plane.png)
_å‡ºæ‰€: [One dbt: the biggest features we announced at Coalesce 2024 | dbt Labs](https://www.getdbt.com/blog/coalesce-2024-product-announcements)_

ã—ã‹ã—ã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®åŸºç›¤æ•´å‚™ã«ã¯ã€ã¾ã ã„ãã¤ã‹ã®èª²é¡ŒãŒæ®‹ã•ã‚Œã¦ã„ã¾ã™ã€‚ç‰¹ã«æ³¨ç›®ã™ã¹ããªã®ãŒã€æ—¢å­˜ã®ãƒ¢ãƒ€ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚¿ãƒƒã‚¯ç³»ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’çµ„ã¿åˆã‚ã›ã¦ã‚‚**ãƒ“ã‚¸ãƒã‚¹çš„ãªæ„å‘³ã‚„é–¢é€£æ€§ã‚’å«ã‚ãŸãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†ãŒå›°é›£ã§ã‚ã‚‹ã“ã¨**ã§ã™ã€‚

æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã‚«ã‚¿ãƒ­ã‚°ãƒ„ãƒ¼ãƒ«ã®å¤šãã¯ã€ç‰©ç†çš„ãªãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ã«ä¸»çœ¼ã‚’ç½®ã„ã¦ãŠã‚Šã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®ã‚ˆã†ãªè«–ç†çš„ãªãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç¶²ç¾…çš„ã«æ‰±ãˆã‚‹ã‚‚ã®ã¯ã€ä»Šã®ã¨ã“ã‚è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã§ã—ãŸã€‚

```mermaid
flowchart LR
  A["Source"] --> B[("DWH")] --> C["Semantic Layer"] --> D["BI"]

subgraph "ãƒ‡ãƒ¼ã‚¿ã‚«ã‚¿ãƒ­ã‚°å¯¾å¿œ "
  A & B
end

subgraph "ãƒ‡ãƒ¼ã‚¿ã‚«ã‚¿ãƒ­ã‚°å¯¾å¿œ"
  D
end
```

ã¨ã“ã‚ãŒå¹¸ã„ãªã“ã¨ã« dbt Cloud ã«ã¯ Discovery API ã¨ã„ã†æ©Ÿèƒ½ãŒã‚ã‚Šã€ã“ã‚Œã‚’ä½¿ãˆã°ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã‚’å«ã‚€æ§˜ã€…ãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚**ç‰¹ã«ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«é–“ã®é–¢ä¿‚æ€§ã‚’ç†è§£ã™ã‚‹ã“ã¨ã¯ã€ãƒ‡ãƒ¼ã‚¿ã®æ„å‘³ã‚„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠŠæ¡ã™ã‚‹ä¸Šã§é‡è¦ãªè¦ç´ ã¨ãªã‚Šã¾ã™**ã€‚

:::message
çµŒé¨“å‰‡ã«ã¯ãªã‚Šã¾ã™ãŒã€ç‰¹ã« SQL ã«ç²¾é€šã—ãŸãƒ“ã‚¸ãƒã‚¹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã»ã©ã€DWH ã¨ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®é•ã„ã«æˆ¸æƒ‘ã†ã“ã¨ãŒå¤šã„ã§ã™ï¼ˆã‚‚ã¡ã‚ã‚“èª¬æ˜ã™ã‚Œã°ç†è§£ã¯æ—©ã„ã®ã§ã™ãŒ...ï¼‰ã€‚

ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®å…¨ä½“åƒã‚‚å¯è¦–åŒ–ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨è€…ãŒãƒ‡ãƒ¼ã‚¿ã®æŒã¤æ„å‘³ã‚„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã€ç›¸äº’ã®é–¢é€£æ€§ã‚’ã‚ˆã‚Šç›´æ„Ÿçš„ã«ç†è§£ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã€ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨ä½“é¨“ã®å‘ä¸Šã‚„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ã‚¹ãƒˆã®å‰Šæ¸›ãŒæœŸå¾…ã•ã‚Œã¾ã™ã€‚
:::

ãã“ã§ã€å½“è¨˜äº‹ã§ã¯ dbt Cloud ã® Discovery API ã‚’æ´»ç”¨ã—ã¦ã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®é–¢ä¿‚æ€§ã‚’ mermaid.js ã§å¯è¦–åŒ–ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚ã“ã‚Œã¯æœ¬æ ¼çš„ãªãƒ‡ãƒ¼ã‚¿ã‚«ã‚¿ãƒ­ã‚°ãƒ„ãƒ¼ãƒ«ã§ã®å¯¾å¿œãŒæ•´ã†ã¾ã§ã®æš«å®šçš„ãªè§£æ±ºç­–ã«ã¯ãªã‚Šã¾ã™ãŒã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®å…¨ä½“åƒã‚’æŠŠæ¡ã™ã‚‹åŠ©ã‘ã«ãªã‚‹ã¯ãšã§ã™ã€‚

## ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®åŸºæœ¬çš„ãªæ¦‚å¿µ

ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã«é–¢ã™ã‚‹ Discovery API ã®æ´»ç”¨æ–¹æ³•ã‚’èª¬æ˜ã™ã‚‹å‰ã«ã€ã¾ãšã¯ãã®åŸºæœ¬çš„ãªæ¦‚å¿µã«ã¤ã„ã¦æ•´ç†ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

:::message
dbt Semantic Layer ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€[Tokyo dbt Meetup #9](https://www.meetup.com/ja-JP/tokyo-dbt-meetup/events/301497854/?eventorigin=group_events_list) ã§ç™ºè¡¨ã—ãŸã€Œ[dbt Semantic Layer ( MetricFlow ) ã®ç†è§£ã‚’æ·±ã‚ã‚‹](https://speakerdeck.com/tanuuuuuuu/dbt-semantic-layer-metricflow-noli-jie-woshen-meru)ã€ã¨ã„ã†è³‡æ–™ã«ã¾ã¨ã‚ã¦ã„ã‚‹ã®ã§ã€å½“è¨˜äº‹ã§ã¯è©³ç´°ãªèª¬æ˜ã¯çœç•¥ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚
:::

### ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰è«–ç†ãƒ¢ãƒ‡ãƒ«ã¸ã®å¤‰æ›

ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®æœ¬è³ªã¯ã€ç‰©ç†çš„ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ãƒ“ã‚¸ãƒã‚¹ã®æ–‡è„ˆã«å³ã—ãŸè«–ç†çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã¸ã¨å¤‰æ›ã™ã‚‹ã“ã¨ã«ã‚ã‚Šã¾ã™ã€‚

ã“ã®å¤‰æ›ã«ã‚ˆã‚Šã€ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚„ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒæ§‹ç¯‰ã—ãŸç‰©ç†çš„ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ã€ãƒ“ã‚¸ãƒã‚¹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦ã‚ˆã‚Šç†è§£ã—ã‚„ã™ã„å½¢ã«å†æ§‹æˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```mermaid
flowchart LR
  A["dbt Model"]:::mdl --> B["Semantic Model"]:::sem
  classDef mdl stroke:#48a4db,stroke-width:2px,fill:#bae6fd;
  classDef sem stroke:#f97583,stroke-width:2px,fill:#ff9eaa;
```

### ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã¨è«–ç†ãƒ¢ãƒ‡ãƒ«ã®é–¢ä¿‚æ€§

ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®é‡è¦ãªç‰¹å¾´ã¨ã—ã¦ã€ç‰©ç†çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã¨è«–ç†çš„ãªã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã¨ã®é–“ã«ã¯ã€ 1 å¯¾å¤šã®é–¢ä¿‚æ€§ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ã€1 ã¤ã®ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰è¤‡æ•°ã®ç•°ãªã‚‹è¦–ç‚¹ã‚„ç”¨é€”ã«å¿œã˜ãŸã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã§ãã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚

```mermaid
flowchart LR
  A["MDL"]:::mdl --> B["SEM1"]:::sem & C["SEM2"]:::sem & D["SEM3"]:::sem
  classDef mdl stroke:#48a4db,stroke-width:2px,fill:#bae6fd;
  classDef sem stroke:#f97583,stroke-width:2px,fill:#ff9eaa;
```

### ãƒãƒ«ãƒãƒ›ãƒƒãƒ—çµåˆã®åˆ¶ç´„

ã¾ãŸã€dbt Semantic Layer ã§ã¯ã€ãƒ†ãƒ¼ãƒ–ãƒ«é–“ã®çµåˆï¼ˆJOINï¼‰ã«ã€Œ2 ãƒ›ãƒƒãƒ—ã¾ã§ã€ã¨ã„ã†åˆ¶ç´„ãŒã‚ã‚Šã¾ã™ã€‚

https://docs.getdbt.com/docs/build/join-logic#multi-hop-joins

ã“ã‚Œã¯ä¾‹ãˆã°ã€æ³¨æ–‡ï¼ˆordersï¼‰ã‹ã‚‰é¡§å®¢ï¼ˆcustomersï¼‰ã€ã•ã‚‰ã«å›½ï¼ˆcountriesï¼‰ã¾ã§ã®çµåˆã¯ã§ãã¾ã™ãŒã€ãã“ã‹ã‚‰ã•ã‚‰ã«åœ°åŸŸï¼ˆregionsï¼‰ã¾ã§ã¯çµåˆã§ããªã„ã¨ã„ã†ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚

```mermaid
flowchart LR
A["orders"] --> B["âœ… customers"] --> C["âœ… countries"] --> D["âŒ regions"]
A --> E["âœ… products"] --> F["âœ… categories"] & G["âœ… brands"]
```

ã“ã®åˆ¶ç´„ã‚‚ã‚ã‚Šã€å®Ÿéš›ã®ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®æ§‹é€ ã¯ã€ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒŠãƒ«ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã‚„ OBT ãªã©ã€ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒªãƒ³ã‚°æ‰‹æ³•ã«åŸºã¥ã„ã¦è¨­è¨ˆã•ã‚Œã‚‹ã“ã¨ãŒä¸€èˆ¬çš„ã§ã™ã€‚

## 1 å¯¾å¤šã®é–¢ä¿‚æ€§ã‚’æŒã¤ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®ä¾‹

å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã§ã‚ˆãè¦‹ã‚‰ã‚Œã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã® 1 ã¤ã«ã€Œ**ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤ãƒ³ã‚°ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³**ã€ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒŠãƒ«ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã«ãŠã„ã¦ 1 ã¤ã®ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè¤‡æ•°ã®å½¹å‰²ã‚’æ‹…ã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŒ‡ã—ã¾ã™ã€‚

### ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã®æ§‹é€ 

ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€`dim_date` ãƒ¢ãƒ‡ãƒ«ã¯ `fct_order` ãƒ¢ãƒ‡ãƒ«ã«å¯¾ã—ã¦ã€æ³¨æ–‡æ—¥ï¼ˆ`order_date`ï¼‰ã¨åˆå›æ³¨æ–‡æ—¥ï¼ˆ`first_order_date`ï¼‰ã¨ã„ã† 2 ã¤ã®ç•°ãªã‚‹å½¹å‰²ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

```mermaid
erDiagram
dim_date ||--|{ fct_order : "order_date_key"
dim_date ||--|{ fct_order : "first_order_date_key"
dim_user ||--|{ fct_order : "user_key"
dim_product ||--|{ fct_order : "product_key"

fct_order {
  order_key int64 "SK"
  order_date_key int64 "FK"
  first_order_date_key int64 "FK"
  user_key int64 "FK"
  product_key int64 "FK"
  order_id string "PK, DD"
  order_item_no int64 "PK, DD"
  order_date datetime "DD"
  item_price int64
}

%%{init: {
  "theme": "neutral",
  "themeCSS": [
    ".er.relationshipLabel { fill: black; }",
    ".er.relationshipLabelBox { fill: white; }",
    ".er.entityBox { fill: light; }",
    "[id^=entity-dim] .er.entityBox { fill: #ffbf00; }",
    "[id^=entity-fct] .er.entityBox { fill: lightblue; }"
  ]
}}%%
```

### è«–ç†ãƒ¢ãƒ‡ãƒ«ã¸ã®å¤‰æ›

ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤ãƒ³ã‚°ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã¯ã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›ã•ã‚Œã‚‹éš›ã«ã€ãã‚Œãã‚Œã®å½¹å‰²ã«å¿œã˜ã¦å€‹åˆ¥ã®ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã¨ã—ã¦è¡¨ç¾ã•ã‚Œã¾ã™ã€‚

ä»¥ä¸‹ã®å›³ã¯ã€ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰è«–ç†ãƒ¢ãƒ‡ãƒ«ã¸ã®å¤‰æ›ã®ä¾‹ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

![](/images/ee31bc0466094d/semantic_model1.png)

ã“ã®å¤‰æ›éç¨‹ã§ã¯ã€ãƒ¢ãƒ‡ãƒ«ã®å‘½åè¦å‰‡ã‚‚å¤‰æ›´ã—ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã¯å˜ãªã‚‹å¥½ã¿ã®å•é¡Œã§ã¯ãªãã€ãã‚Œãã‚Œã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«æœ€é©åŒ–ã—ãŸå‘½åæ–¹é‡ã§ã™ã€‚

- **dbt Modelï¼ˆç‰©ç†ãƒ¢ãƒ‡ãƒ«ï¼‰ã®å‘½åè¦å‰‡:** æŠ€è¡“çš„ãªæ•´ç†ã‚’é‡è¦–ã—ãŸå‘½å
  - ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼ˆ`fct_` / `dim_`ï¼‰ã‚’å…ˆé ­ã«é…ç½®
  - DWH å†…ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã‚„æ¤œç´¢ã®åŠ¹ç‡åŒ–ã‚’é‡è¦–
- **Semantic Modelï¼ˆè«–ç†ãƒ¢ãƒ‡ãƒ«ï¼‰ã®å‘½åè¦å‰‡:** ãƒ“ã‚¸ãƒã‚¹çš„ãªæ„å‘³ã‚’é‡è¦–ã—ãŸå‘½å
  - ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼ˆ`_fact` / `_dimension`ï¼‰ã‚’æœ«å°¾ã«é…ç½®
  - ãƒ“ã‚¸ãƒã‚¹ä¸Šã®æ¦‚å¿µã‚’åå‰ã®å…ˆé ­ã§å¼·èª¿

å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ãƒãƒ¼ãƒ ã®åˆæ„ã®ã‚‚ã¨ã€ä¸€è²«æ€§ã®ã‚ã‚‹å‘½åè¦å‰‡ã‚’æ¡ç”¨ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

### å¤‰æ›å¾Œã®ãƒ¢ãƒ‡ãƒ«æ§‹é€ 

ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã§ã¯ã€ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã® `dim_date` ãŒ `order_date_dimension` ã¨ `first_order_date_dimension` ã¨ã„ã† 2 ã¤ã®è«–ç†ãƒ¢ãƒ‡ãƒ«ã«åˆ†å‰²ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«å½¹å‰²ã”ã¨ã«ãƒ¢ãƒ‡ãƒ«ã‚’åˆ†ã‘ã‚‹ã“ã¨ã§ã€å„æ—¥ä»˜ã®æŒã¤æ„å‘³ãŒã‚ˆã‚Šæ˜ç¢ºã«ãªã‚Šã€BI ãƒ„ãƒ¼ãƒ«ã§ã®ãƒ¬ãƒãƒ¼ãƒˆãƒ©ãƒ™ãƒ«ã‚„åˆ†ææ™‚ã®æ··ä¹±ã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚

```mermaid
erDiagram
order_date_dimension ||--|{ order_fact : "order_date_key"
first_order_date_dimension ||--|{ order_fact : "first_order_date_key"
user_dimension ||--|{ order_fact : "user_key"
product_dimension ||--|{ order_fact : "product_key"

order_fact {
  order_key int64 "PK"
  order_date_key int64 "FK"
  first_order_date_key int64 "FK"
  user_key int64 "FK"
  product_key int64 "FK"
  order_id categorical
  order_item_no categorical
  order_date time
  item_price int64
}

%%{init: {
  "theme": "neutral",
  "themeCSS": [
    ".er.relationshipLabel { fill: black; }",
    ".er.relationshipLabelBox { fill: white; }",
    ".er.entityBox { fill: light; }",
    "[id*=dimension] .er.entityBox { fill: #ffbf00; }",
    "[id*=fact] .er.entityBox { fill: lightblue; }"
    ]
}}%%
```

### ã€ãŠã¾ã‘ã€‘ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤ãƒ³ã‚°ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã®è¨­å®šä¾‹

:::details dbt Semantic Layer

```yaml:dim_date.yml
semantic_models:
  - name: order_date_dimension
    model: ref('dim_date')
    description: "æ³¨æ–‡æ—¥ä»˜ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«"

    entities:
      - name: order_date_key
        type: primary
        expr: date_key

    dimensions:
      - name: order_year_and_month
        type: categorical
        expr: year_and_month
        label: "[ğŸ“… order_date] æ³¨æ–‡å¹´æœˆï¼ˆyyyymmï¼‰"
        description: ""

      - name: order_year
        type: categorical
        expr: year
        label: "[ğŸ“… order_date] æ³¨æ–‡å¹´ï¼ˆyyyyï¼‰"
        description: ""

      - name: order_month
        type: categorical
        expr: month
        label: "[ğŸ“… order_date] æ³¨æ–‡æœˆï¼ˆmï¼‰"
        description: ""

      - name: order_day
        type: categorical
        expr: day
        label: "[ğŸ“… order_date] æ³¨æ–‡æ—¥ï¼ˆdï¼‰"
        description: ""

      - name: order_day_of_week
        type: categorical
        expr: |
          case
            when day_of_week = 'æœˆ' then '1. æœˆ'
            when day_of_week = 'ç«' then '2. ç«'
            when day_of_week = 'æ°´' then '3. æ°´'
            when day_of_week = 'æœ¨' then '4. æœ¨'
            when day_of_week = 'é‡‘' then '5. é‡‘'
            when day_of_week = 'åœŸ' then '6. åœŸ'
            when day_of_week = 'æ—¥' then '7. æ—¥'
            else day_of_week
          end
        label: "[ğŸ“… order_date] æ³¨æ–‡æ›œæ—¥"
        description: ""

      - name: is_holiday
        type: categorical
        expr: is_holiday
        label: "[ğŸ“… order_date] ä¼‘æ—¥ãƒ•ãƒ©ã‚°"
        description: ""

      - name: is_public_holiday
        type: categorical
        expr: is_public_holiday
        label: "[ğŸ“… order_date] ç¥æ—¥ãƒ•ãƒ©ã‚°"
        description: ""

  - name: first_order_date_dimension
    model: ref('dim_date')
    description: "åˆå›æ³¨æ–‡æ—¥ä»˜ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«"

    entities:
      - name: first_order_date_key
        type: primary
        expr: date_key

    dimensions:
      - name: first_order_date
        type: time
        expr: full_date
        type_params:
          time_granularity: day
        label: "[ğŸ“… first_order_date] åˆå›æ³¨æ–‡æ—¥"
        description: ""

      - name: first_order_year_and_month
        type: categorical
        expr: year_and_month
        label: "[ğŸ“… first_order_date] åˆå›æ³¨æ–‡å¹´æœˆï¼ˆyyyymmï¼‰"
        description: ""

      - name: first_order_year
        type: categorical
        expr: year
        label: "[ğŸ“… first_order_date] åˆå›æ³¨æ–‡å¹´ï¼ˆyyyyï¼‰"
        description: ""
```

:::

:::details Steepï¼ˆBI ãƒ„ãƒ¼ãƒ«ï¼‰ã§ã®ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤ãƒ³ã‚°ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã®è¦‹ãˆæ–¹
![](/images/ee31bc0466094d/steep_dimension.png =400x)
:::

## Discovery API ã®æ¦‚è¦

dbt Cloud ã® Discovery API ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã® GraphQL ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã‚„ dbt ãƒ¢ãƒ‡ãƒ«ã€å®Ÿè¡Œçµæœãªã©ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é–¢ã™ã‚‹æ§˜ã€…ãªæƒ…å ±ã‹ã‚‰å¿…è¦ãªã‚‚ã®ã ã‘ã‚’æŸ”è»Ÿã«å–å¾—ã§ãã¾ã™ã€‚

:::message alert
Discovery API ã¯ dbt Cloud ã®ãƒãƒ¼ãƒ ã¾ãŸã¯ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ—ãƒ©ãƒ³ã§ã®ã¿åˆ©ç”¨å¯èƒ½ã§ã™ã€‚
:::

ã“ã® API ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿åŸºç›¤ã®é‹ç”¨æ”¹å–„ãŒå¯èƒ½ã«ãªã‚Šã¾ã™:

- ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã¨ã‚¢ãƒ©ãƒ¼ãƒˆ
- ãƒ‡ãƒ¼ã‚¿ãƒªãƒãƒ¼ã‚¸ã®æ¢ç´¢
- è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- ãƒ‡ãƒ¼ã‚¿å“è³ªã®ç®¡ç†
- ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³é‹ç”¨ã®æ”¹å–„

![](/images/ee31bc0466094d/about_discovery_api.png)
_å‡ºæ‰€: [About the Discovery API | dbt Labs](https://docs.getdbt.com/docs/dbt-cloud-apis/discovery-api)_

### Discovery API ã‚’ä½¿ç”¨ã™ã‚‹æ‰‹é †

ä»¥ä¸‹ã®æ‰‹é †ã§ Discovery API ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™:

1. ã‚µãƒ¼ãƒ“ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ç™ºè¡Œ
2. GraphQL ã‚¯ã‚¨ãƒªã®ä½œæˆ

https://docs.getdbt.com/docs/dbt-cloud-apis/discovery-querying

#### 1. ã‚µãƒ¼ãƒ“ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ç™ºè¡Œ

Discovery API ç”¨ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¯ã€dbt Cloud ã® `Account Settings` > `Settings` > `API tokens` > `Service tokens` ã‹ã‚‰ç™ºè¡Œã§ãã¾ã™ã€‚

![](/images/ee31bc0466094d/service_token.png)
_Service tokens_

ç™ºè¡Œæ™‚ã«ã¯ä»¥ä¸‹ã®ç‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„:

- ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã™ã‚‹
- æ¨©é™ã¯ `Metadata Only` ã‚’æŒ‡å®šã™ã‚‹
- ç™ºè¡Œã—ãŸãƒˆãƒ¼ã‚¯ãƒ³ã¯ä¸€åº¦ã—ã‹è¡¨ç¤ºã•ã‚Œãªã„ãŸã‚ã€å®‰å…¨ãªå ´æ‰€ã«ä¿ç®¡ã™ã‚‹

#### 2. GraphQL ã‚¯ã‚¨ãƒªã®ä½œæˆ

ã‚¯ã‚¨ãƒªã®ä½œæˆã«ã¯ã€dbt Cloud ãŒæä¾›ã™ã‚‹ [GraphQL explorer](https://metadata.cloud.getdbt.com/graphql) ã‚’ä½¿ç”¨ã™ã‚‹ã¨ä¾¿åˆ©ã§ã™ã€‚ã“ã®ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒã§ã€å®Ÿéš›ã®ã‚¯ã‚¨ãƒªã‚’ãƒ†ã‚¹ãƒˆã—ãªãŒã‚‰ä½œæˆã§ãã¾ã™ã€‚

![](/images/ee31bc0466094d/graphql_explorer.png)
_GraphQL explorer_

ä»¥ä¸‹ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã‚¯ã‚¨ãƒªã®ä¾‹ã§ã™ã€‚

```graphql
query Dimensions($environmentId: BigInt!, $first: Int) {
  environment(id: $environmentId) {
    definition {
      semanticModels(first: $first) {
        edges {
          node {
            name
            dimensions {
              name
              type
            }
            measures {
              name
              expr
            }
            entities {
              name
              type
            }
          }
        }
      }
    }
  }
}
```

### Python ã§ Discovery API ã‚’ä½¿ç”¨ã™ã‚‹

å®Ÿé‹ç”¨æ™‚ã«ã¯æ§˜ã€…ãªè¨­å®šãŒå¿…è¦ã«ãªã‚Šã¾ã™ãŒã€ä»¥ä¸‹ã¯ Discovery API ã‚’ Python ã§ä½¿ç”¨ã™ã‚‹ãŸã‚ã®æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚èªè¨¼ã¨ã‚¯ã‚¨ãƒªã®åŸºæœ¬çš„ãªå®Ÿè¡Œæ–¹æ³•ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

```python:main.py
import requests

DBT_ENVIRONMENT_ID = "{{ YOUR_ENVIRONMENT_ID }}"
DBT_DISCOVERY_API_KEY = "{{ YOUR_DISCOVERY_API_KEY }}"
DBT_DISCOVERY_API_ENDPOINT = "{{ YOUR_DISCOVERY_API_ENDPOINT }}"

def main() -> None:
    # ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã‚¯ã‚¨ãƒª
    query_string = """
    query Dimensions($environmentId: BigInt!, $first: Int) {
      environment(id: $environmentId) {
        definition {
          semanticModels(first: $first) {
            edges {
              node {
                name
                dimensions {
                  name
                  type
                }
                measures {
                  name
                  expr
                }
                entities {
                  name
                  type
                }
              }
            }
          }
        }
      }
    }
    """
    query_variables = {
        "environmentId": DBT_ENVIRONMENT_ID,
        "first": 500  # å–å¾—ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã®ä¸Šé™æ•°
    }
    # APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®Ÿè¡Œ
    response = requests.post(
        DBT_DISCOVERY_API_ENDPOINT,
        headers={
            "authorization": f"Bearer {DBT_DISCOVERY_API_KEY}",
            "content-type": "application/json",
        },
        json={"query": query_string, "variables": query_variables},
    )
    print(response.json())

if __name__ == "__main__":
    main()
```

:::message alert
é‡ˆè¿¦ã«èª¬æ³•ã§ã™ãŒã€å®Ÿéš›ã«åˆ©ç”¨ã™ã‚‹éš›ã«ã¯ã€ç’°å¢ƒå¤‰æ•°ã‚„ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’ä½¿ã£ã¦ API ã‚­ãƒ¼ã‚„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’éš ã—ãŸã‚Šã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚„ãƒ‘ãƒ•ã‚©ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚
:::

## mermaid.js ã§ ER å›³ã‚’æç”»ã™ã‚‹

[mermaid.js](https://mermaid.js.org/) ã¯ã€Markdown ãƒ©ã‚¤ã‚¯ãªæ›¸ãæ–¹ã§ ER å›³ã‚„ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆãªã©ã®å›³ã‚’æç”»ã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã“ã¨ã§ã€ç°¡å˜ã« ER å›³ã‚’è¨˜è¿°ã—ã€ã•ã¾ã–ã¾ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ Web ãƒšãƒ¼ã‚¸ä¸Šã«å›³ã‚’æç”»ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

https://mermaid.js.org/syntax/entityRelationshipDiagram.html

### ER å›³ã®è¨˜æ³•

mermaid.js ã§ ER å›³ã‚’æç”»ã™ã‚‹ãŸã‚ã®åŸºæœ¬çš„ãªè¨˜æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

#### 1. ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å®šç¾©

ER å›³ã¯ `erDiagram` ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§é–‹å§‹ã—ã€æ³¢æ‹¬å¼§ `{}` ã‚’ä½¿ã£ã¦ã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ã¨ãã®å±æ€§ã‚’å®šç¾©ã—ã¾ã™ã€‚

```console
erDiagram

dim_user {
  user_key int64 "SK"
  user_id string "PK"
  user_name string
}

fct_order {
  order_key int64 "SK"
  user_key int64 "FK"
  order_id string "PK, DD"
  order_date datetime "DD"
}
```

```mermaid
erDiagram

dim_user {
  user_key int64 "SK"
  user_id string "PK"
  user_name string
}

fct_order {
  order_key int64 "SK"
  user_key int64 "FK"
  order_id string "PK, DD"
  order_date datetime "DD"
}
```

#### 2. é–¢ä¿‚æ€§ã®å®šç¾©

ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£é–“ã®é–¢ä¿‚ã¯çŸ¢å°ã‚’ä½¿ã£ã¦è¡¨ç¾ã—ã¾ã™ã€‚

- `||--||`: 1 å¯¾ 1 ã®é–¢ä¿‚ï¼ˆå¿…é ˆï¼‰
- `||--o|`: 1 å¯¾ 1 ã®é–¢ä¿‚ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- `||--|{`: 1 å¯¾å¤šã®é–¢ä¿‚ï¼ˆå¿…é ˆï¼‰
- `||--o{`: 1 å¯¾å¤šã®é–¢ä¿‚ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```console
erDiagram

dim_user {
  user_key int64 "SK"
  user_id string "PK"
  user_name string
}

fct_order {
  order_key int64 "SK"
  user_key int64 "FK"
  order_id string "PK, DD"
  order_date datetime "DD"
}

dim_user ||--|{ fct_order : "user_key"
```

```mermaid
erDiagram

dim_user {
  user_key int64 "SK"
  user_id string "PK"
  user_name string
}

fct_order {
  order_key int64 "SK"
  user_key int64 "FK"
  order_id string "PK, DD"
  order_date datetime "DD"
}

dim_user ||--|{ fct_order : "user_key"
```

#### 3. é–¢ä¿‚æ€§ã®æ–¹å‘åˆ¶å¾¡

ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®è¨˜è¿°é †åºã‚’å¤‰ãˆã‚‹ã“ã¨ã§ã€çŸ¢å°ã®æ–¹å‘ã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚ã“ã‚Œã¯ ER å›³ã®è¦–èªæ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã®é‡è¦ãªãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã§ã™ã€‚

```console
erDiagram

dim_user {
  user_key int64 "SK"
  user_id string "PK"
  user_name string
}

fct_order {
  order_key int64 "SK"
  user_key int64 "FK"
  order_id string "PK, DD"
  order_date datetime "DD"
}

fct_order }|--|| dim_user : "user_key"
```

```mermaid
erDiagram

dim_user {
  user_key int64 "SK"
  user_id string "PK"
  user_name string
}

fct_order {
  order_key int64 "SK"
  user_key int64 "FK"
  order_id string "PK, DD"
  order_date datetime "DD"
}

fct_order }|--|| dim_user : "user_key"
```

#### 4. ãƒ†ãƒ¼ãƒã®è¨­å®š

ER å›³ã®è¦‹ãŸç›®ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ãŸã‚ã«ã€ãƒ†ãƒ¼ãƒã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã‚‚è¦–èªæ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã®é‡è¦ãªãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã§ã™ã€‚

```console
erDiagram

dim_user {
  user_key int64 "SK"
  user_id string "PK"
  user_name string
}

fct_order {
  order_key int64 "SK"
  user_key int64 "FK"
  order_id string "PK, DD"
  order_date datetime "DD"
}

dim_user ||--|{ fct_order : "user_key"

%%{init: {
  "theme": "neutral",
  "themeCSS": [
    ".er.relationshipLabel { fill: black; }",
    ".er.relationshipLabelBox { fill: white; }",
    ".er.entityBox { fill: light; }",
    "[id^=entity-dim] .er.entityBox { fill: #ffbf00; }",
    "[id^=entity-fct] .er.entityBox { fill: lightblue; }"
  ]
}}%%
```

```mermaid
erDiagram

dim_user {
  user_key int64 "SK"
  user_id string "PK"
  user_name string
}

fct_order {
  order_key int64 "SK"
  user_key int64 "FK"
  order_id string "PK, DD"
  order_date datetime "DD"
}

dim_user ||--|{ fct_order : "user_key"

%%{init: {
  "theme": "neutral",
  "themeCSS": [
    ".er.relationshipLabel { fill: black; }",
    ".er.relationshipLabelBox { fill: white; }",
    ".er.entityBox { fill: light; }",
    "[id^=entity-dim] .er.entityBox { fill: #ffbf00; }",
    "[id^=entity-fct] .er.entityBox { fill: lightblue; }"
  ]
}}%%
```

### Python ã§ mermaid.jsï¼ˆER å›³ï¼‰ ã®è¨˜æ³•ã‚’ç”Ÿæˆã™ã‚‹

mermaid.js ã‚’ Python ã‹ã‚‰ç›´æ¥åˆ©ç”¨ã§ãã‚‹ API ã¯æä¾›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€mermaid.js ã® ER å›³è¨˜æ³•ã«å¾“ã£ãŸãƒ†ã‚­ã‚¹ãƒˆã‚’ç”Ÿæˆã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

å½“è¨˜äº‹ã§ã¯è©³ç´°ã¯å‰²æ„›ã—ã¾ã™ãŒã€GitHub ã«ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’å…¬é–‹ã—ã¦ã„ã‚‹ã®ã§å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

https://github.com/tanuuuuuuu/dbt-semantic-erd/blob/main/src/erd_generator.py

## ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®é–¢ä¿‚æ€§ã‚’å¯è¦–åŒ–ã™ã‚‹

### å®Ÿç¾ã—ãŸã„ã“ã¨ã®ç¢ºèª

ä»¥ä¸Šã®å†…å®¹ã‚’è¸ã¾ãˆã¦ã€ã¾ãšç‰©ç†ãƒ¢ãƒ‡ãƒ«ï¼ˆã‚¹ã‚¿ãƒ¼ã‚¹ã‚­ãƒ¼ãƒï¼‰ã‹ã‚‰ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ï¼ˆâ€»ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤ãƒ³ã‚°ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã‚’å«ã‚€ï¼‰ã‚’ä½œæˆã—ã€ãã®ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«é–“ã®é–¢ä¿‚æ€§ã‚’ mermaid.js ã§å¯è¦–åŒ–ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚

- **ãƒ‡ãƒ¼ã‚¿æ§‹é€ :**
  - **ç‰©ç†ãƒ¢ãƒ‡ãƒ«ï¼ˆdbt ãƒ¢ãƒ‡ãƒ«ï¼‰**: ã‚¹ã‚¿ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ
  - **è«–ç†ãƒ¢ãƒ‡ãƒ«ï¼ˆã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ï¼‰**: ã‚¹ã‚¿ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ
- **æ‰‹æ®µ:**
  - **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®å–å¾—æ‰‹æ®µ**: Discovery APIï¼ˆdbt Cloudï¼‰
  - **ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª**: Python
  - **ER å›³ã®å¯è¦–åŒ–**: mermaid.js

### ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã®æ§‹é€ 

- ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«: ã‚¹ã‚¿ãƒ¼ã‚¹ã‚­ãƒ¼ãƒï¼ˆãƒãƒ«ãƒã‚¹ã‚¿ãƒ¼ï¼‰
- ãƒ•ã‚¡ã‚¯ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«:
  - `fct_order`: æ³¨æ–‡ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ»ãƒ•ã‚¡ã‚¯ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«
  - `fct_access_daily`: ã‚¢ã‚¯ã‚»ã‚¹å®šæœŸã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ»ãƒ•ã‚¡ã‚¯ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«
- ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«:
  - `dim_date`: æ—¥ä»˜ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆ3 Role playï¼‰
  - `dim_product`: å•†å“ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«
  - `dim_user`: é¡§å®¢ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«

```mermaid
erDiagram

dim_date ||--|{ fct_access_daily : "date_key"
dim_date ||--|{ fct_order : "order_date_key"
dim_date ||--|{ fct_order : "first_order_date_key"
fct_access_daily }|--|| dim_product : "product_key"
fct_order }|--|| dim_product : "product_key"
fct_order }|--|| dim_user : "user_key"


fct_access_daily {
  access_daily_key int64 "SK"
  date_key int64 "PK, FK"
  product_key int64 "PK, FK"
  snapshot_date datetime "DD"
  session int64
}

dim_date {
  date_key int64 PK
  full_date datetime
  year_and_month string
}

fct_order {
  order_key int64 "SK"
  order_date_key int64 "FK"
  first_order_date_key int64 "FK"
  product_key int64 "FK"
  user_key int64 "FK"
  order_id string "PK, DD"
  order_item_no int64 "PK, DD"
  order_date datetime "DD"
  item_price int64
}

dim_product {
  product_key int64 "SK"
  product_id string "PK"
  product_name string
}

dim_user {
  user_key int64 "SK"
  user_id string "PK"
  user_name string
}


%%{init: {
  "theme": "neutral",
  "themeCSS": [
    ".er.relationshipLabel { fill: black; }",
    ".er.relationshipLabelBox { fill: white; }",
    ".er.entityBox { fill: light; }",
    "[id^=entity-dim] .er.entityBox { fill: #ffbf00; }",
    "[id^=entity-fct] .er.entityBox { fill: lightblue; }"
  ]
}}%%
```

### è«–ç†ãƒ¢ãƒ‡ãƒ«ã¸ã®å¤‰æ›

ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã® `dim_date` ãŒ `date_dimension` ã¨ `order_date_dimension` ã¨ `first_order_date_dimension` ã¨ã„ã† 3 ã¤ã®è«–ç†ãƒ¢ãƒ‡ãƒ«ã«åˆ†å‰²ã•ã‚Œã¦ã„ã¾ã™ã€‚

![](/images/ee31bc0466094d/semantic_model2.png)

### å¤‰æ›å¾Œã®ãƒ¢ãƒ‡ãƒ«æ§‹é€ 

è«–ç†ãƒ¢ãƒ‡ãƒ«ã¸ã®å¤‰æ›ã«ã‚ˆã‚Šã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«é–“ã®é–¢ä¿‚æ€§ã‚’è¡¨ã—ãŸ ER å›³ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```mermaid
erDiagram

date_dimension ||--|{ access_daily_fact : "date_key"
order_date_dimension ||--|{ order_fact : "order_date_key"
first_order_date_dimension ||--|{ order_fact : "first_order_date_key"
access_daily_fact }|--|| product_dimension : "product_key"
order_fact }|--|| product_dimension : "product_key"
order_fact }|--|| user_dimension : "user_key"


access_daily_fact {
  access_daily_key int64 "PK"
  date_key int64 "FK"
  product_key int64 "FK"
  snapshot_date time
  session int64
}

date_dimension {
  date_key int64 PK
  full_date time
  year_and_month categorical
}

order_date_dimension {
  order_date_key int64 PK
  full_order_date time
  order_year_and_month categorical
}

first_order_date_dimension {
  first_order_date_key int64 PK
  full_first_order_date time
  first_order_year_and_month categorical
}

order_fact {
  order_key int64 "PK"
  order_date_key int64 "FK"
  first_order_date_key int64 "FK"
  product_key int64 "FK"
  user_key int64 "FK"
  order_id categorical
  order_item_no categorical
  order_date time
  item_price int64
  number_of_orders int64
}

product_dimension {
  product_key int64 "PK"
  product_id categorical
  product_name categorical
}

user_dimension {
  user_key int64 "PK"
  user_id categorical
  user_name categorical
}


%%{init: {
  "theme": "neutral",
  "themeCSS": [
    ".er.relationshipLabel { fill: black; }",
    ".er.relationshipLabelBox { fill: white; }",
    ".er.entityBox { fill: light; }",
    "[id*=dimension] .er.entityBox { fill: #ffbf00; }",
    "[id*=fact] .er.entityBox { fill: lightblue; }"
    ]
}}%%
```

æœ€çµ‚çš„ãªã‚´ãƒ¼ãƒ«ã¯ã€Python ã§ Discovery API ã‹ã‚‰å–å¾—ã—ãŸãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã¨ã«ã€ã“ã® ER å›³ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ã“ã¨ã§ã™ã€‚

### ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

æœ€å¾Œã«ã€Discovery API ã‚’ä½¿ã£ã¦ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€mermaid.js ã®è¨˜æ³•ã«å¤‰æ›ã™ã‚‹å®Ÿè£…ä¾‹ã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚GitHub ãƒªãƒã‚¸ãƒˆãƒªã«ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’å…¬é–‹ã—ã¦ã„ã¾ã™ã®ã§ã€ãœã²ã”å‚ç…§ãã ã•ã„ã€‚

https://github.com/tanuuuuuuu/dbt-semantic-erd

#### æº–å‚™

`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®å†…å®¹ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

```plain:.env
DBT_ENVIRONMENT_ID={{ YOUR_ENVIRONMENT_ID }}
DBT_DISCOVERY_API_KEY={{ YOUR_DISCOVERY_API_KEY }}
DBT_DISCOVERY_API_ENDPOINT={{ YOUR_DISCOVERY_API_ENDPOINT }}
```

Discovery API ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ã€ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«è¨­å®šã—ã¦ãã ã•ã„ã€‚

https://docs.getdbt.com/docs/dbt-cloud-apis/discovery-querying#discovery-api-endpoints

#### å®Ÿè¡Œ

`main.py` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€Discovery API ã‹ã‚‰å–å¾—ã—ãŸã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã¨ã«ã€mermaid.js ã§ ER å›³ã‚’æç”»ã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

```bash
$ python main.py
```

```console:å‡ºåŠ›çµæœ
erDiagram

access_daily_fact {
  access_daily_key int64 PK
  date_key int64 FK
  product_key int64 FK
  snapshot_date time
  session int64
}

date_dimension {
  date_key int64 PK
  full_date time
  year_and_month categorical
}

first_order_date_dimension {
  first_order_date_key int64 PK
  full_first_order_date time
  first_order_year_and_month categorical
}

order_date_dimension {
  order_date_key int64 PK
  full_order_date time
  order_year_and_month categorical
}

order_fact {
  order_key int64 PK
  order_date_key int64 FK
  first_order_date_key int64 FK
  product_key int64 FK
  user_key int64 FK
  order_id categorical
  order_item_no categorical
  order_date time
  item_price int64
  number_of_orders int64
}

product_dimension {
  product_key int64 PK
  product_id categorical
  product_name categorical
}

user_dimension {
  user_key int64 PK
  user_id categorical
  user_name categorical
}

date_dimension ||--o{ access_daily_fact : "date_key"
access_daily_fact }o--|| product_dimension : "product_key"
order_fact }o--|| order_date_dimension : "order_date_key"
first_order_date_dimension ||--o{ order_fact : "first_order_date_key"
order_fact }o--|| product_dimension : "product_key"
order_fact }o--|| user_dimension : "user_key"

%%{init: {
  "theme": "neutral",
  "themeCSS": [
    ".er.relationshipLabel { fill: black; }",
    ".er.relationshipLabelBox { fill: white; }",
    ".er.entityBox { fill: light; }",
    "[id*=dimension] .er.entityBox { fill: #ffbf00; }",
    "[id*=fact] .er.entityBox { fill: lightblue; }"
  ]
}}%%
```

ã“ã®å‡ºåŠ›çµæœã‚’ã€mermaid.js ã‚’æç”»ã§ãã‚‹ç’°å¢ƒã§ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®é–¢ä¿‚æ€§ã‚’å¯è¦–åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```mermaid
erDiagram

access_daily_fact {
  access_daily_key int64 PK
  date_key int64 FK
  product_key int64 FK
  snapshot_date time
  session int64
}

date_dimension {
  date_key int64 PK
  full_date time
  year_and_month categorical
}

first_order_date_dimension {
  first_order_date_key int64 PK
  full_first_order_date time
  first_order_year_and_month categorical
}

order_date_dimension {
  order_date_key int64 PK
  full_order_date time
  order_year_and_month categorical
}

order_fact {
  order_key int64 PK
  order_date_key int64 FK
  first_order_date_key int64 FK
  product_key int64 FK
  user_key int64 FK
  order_id categorical
  order_item_no categorical
  order_date time
  item_price int64
  number_of_orders int64
}

product_dimension {
  product_key int64 PK
  product_id categorical
  product_name categorical
}

user_dimension {
  user_key int64 PK
  user_id categorical
  user_name categorical
}

date_dimension ||--o{ access_daily_fact : "date_key"
access_daily_fact }o--|| product_dimension : "product_key"
order_fact }o--|| order_date_dimension : "order_date_key"
first_order_date_dimension ||--o{ order_fact : "first_order_date_key"
order_fact }o--|| product_dimension : "product_key"
order_fact }o--|| user_dimension : "user_key"

%%{init: {
  "theme": "neutral",
  "themeCSS": [
    ".er.relationshipLabel { fill: black; }",
    ".er.relationshipLabelBox { fill: white; }",
    ".er.entityBox { fill: light; }",
    "[id*=dimension] .er.entityBox { fill: #ffbf00; }",
    "[id*=fact] .er.entityBox { fill: lightblue; }"
  ]
}}%%
```

#### å·¥å¤«ã—ãŸãƒã‚¤ãƒ³ãƒˆ

- ãƒãƒ«ãƒãƒ›ãƒƒãƒ—çµåˆã®åˆ¶ç´„ã‚’æ´»ã‹ã—ã¦ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã®é…ç½®ã‚’è¦‹ã‚„ã™ãèª¿æ•´
  - ãƒ•ã‚¡ã‚¯ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã¯ã€å¿…ãš 2 æ®µç›®ã«é…ç½®
  - ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ã€ãƒ†ãƒ¼ãƒ–ãƒ«æ•°ã«å¿œã˜ã¦å‡ç­‰ã« 1 æ®µç›®ã€3 æ®µç›®ã«é…ç½®
- ãƒ•ã‚¡ã‚¯ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã¯é’ã€ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã¯é»„è‰²ã§ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è‰²åˆ†ã‘

#### ä»Šå¾Œã®æ”¹å–„ç‚¹

- ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒŠãƒ«ãƒ¢ãƒ‡ãƒªãƒ³ã‚°å‰æã§ã‚ã‚‹ãŸã‚ã€OBT ãªã©ã®ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒªãƒ³ã‚°æ‰‹æ³•ã«åŸºã¥ã„ãŸãƒ¢ãƒ‡ãƒ«ã®æ§‹é€ ã‚’åæ˜ 
- CI/CD ã«çµ„ã¿è¾¼ã¿ã€å¸¸ã«æœ€æ–°ã®ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã‚’è¦‹ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹
- ã‚¢ã‚¦ãƒˆãƒªã‚¬ãƒ¼ã‚„ã‚¹ãƒãƒ¼ãƒ•ãƒ¬ãƒ¼ã‚­ãƒ³ã‚°ãªã©ã®é«˜åº¦ãªãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‹ã¯æœªæ¤œè¨¼
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…ï¼ˆã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ãŒ 500 å€‹ä»¥ä¸Šã‚ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ï¼‰

## ã•ã„ã”ã«

å½“è¨˜äº‹ã§ã¯ã€dbt Cloud ã® Discovery API ã‚’æ´»ç”¨ã—ã¦ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®é–¢ä¿‚æ€§ã‚’å¯è¦–åŒ–ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚

ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæœ¬æ ¼çš„ãªãƒ‡ãƒ¼ã‚¿ã‚«ã‚¿ãƒ­ã‚°ãƒ„ãƒ¼ãƒ«ã§ã®å¯¾å¿œãŒæ•´ã†ã¾ã§ã®æš«å®šçš„ãªå¯¾å¿œç­–ã¨ãªã‚Šã¾ã™ãŒã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®å…¨ä½“åƒã‚’ç´ æ—©ãæŠŠæ¡ã—ã€ãƒ‡ãƒ¼ã‚¿ã®æ„å‘³ã‚„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ç†è§£ã‚’ä¿ƒé€²ã§ãã‚‹ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

æœ€å¾Œã¾ã§ãŠèª­ã¿ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚
